{% extends "admin/base.html" %}

{% block title %}Study Sessions{% endblock %}
{% block page_title %}Study Sessions Management{% endblock %}

{% block content %}
<style>
    .stats-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        border-radius: 12px;
        padding: 24px;
        color: white;
        text-align: center;
    }

    .stat-value {
        font-size: 36px;
        font-weight: 700;
        margin-bottom: 8px;
    }

    .stat-label {
        font-size: 14px;
        opacity: 0.9;
    }

    .session-card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 15px;
    }

    .session-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .mode-badge {
        padding: 6px 16px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 14px;
    }

    .mode-focus {
        background: #10b981;
        color: white;
    }

    .mode-break {
        background: #f59e0b;
        color: white;
    }

    .top-studier {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        border-bottom: 1px solid var(--border);
    }

    .top-studier:last-child {
        border-bottom: none;
    }
</style>

<div class="stats-row">
    <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div class="stat-value">{{ stats.total_sessions }}</div>
        <div class="stat-label">Total Sessions</div>
    </div>
    <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
        <div class="stat-value">{{ stats.total_focus_hours }}</div>
        <div class="stat-label">Focus Hours</div>
    </div>
    <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
        <div class="stat-value">{{ stats.total_break_hours }}</div>
        <div class="stat-label">Break Hours</div>
    </div>
</div>

<!-- Top Studiers -->
<div
    style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 24px; margin-bottom: 24px;">
    <h3 style="margin-bottom: 20px; color: var(--text-primary);">üèÜ Top Studiers</h3>
    {% for user, total_time in stats.top_studiers %}
    <div class="top-studier">
        <div style="display: flex; align-items: center; gap: 12px;">
            <img src="{{ user.get_avatar(40) }}" alt="{{ user.first_name }}"
                style="width: 40px; height: 40px; border-radius: 50%;">
            <div>
                <div style="font-weight: 600; color: var(--text-primary);">{{ user.first_name }} {{ user.last_name }}
                </div>
                <div style="font-size: 14px; color: var(--text-secondary);">Level {{ user.level }}</div>
            </div>
        </div>
        <span style="background: #10b981; color: white; padding: 6px 16px; border-radius: 20px; font-weight: 600;">
            {{ (total_time / 60)|round(1) }} hours
        </span>
    </div>
    {% endfor %}
</div>

<!-- Recent Sessions -->
<h3 style="margin-bottom: 20px; color: var(--text-primary);">Recent Study Sessions</h3>
{% for session in sessions.items %}
<div class="session-card">
    <div class="session-header">
        <div>
            <span class="mode-badge {% if session.mode == 'focus' %}mode-focus{% else %}mode-break{% endif %}">
                {{ session.mode|title }}
            </span>
            <span style="margin-left: 15px; color: var(--text-secondary);">
                User #{{ session.user_id }} ‚Ä¢ {{ session.duration }} minutes
            </span>
            <span style="margin-left: 15px; color: var(--text-secondary); font-size: 14px;">
                {{ session.completed_at.strftime('%Y-%m-%d %H:%M') }}
            </span>
        </div>
    </div>
</div>
{% endfor %}

<!-- Pagination -->
{% if sessions.pages > 1 %}
<div class="admin-pagination" style="margin-top: 30px;">
    {% if sessions.has_prev %}
    <a href="{{ url_for('admin.battles', page=sessions.prev_num) }}" class="admin-btn-secondary">Previous</a>
    {% endif %}
    <span>Page {{ sessions.page }} of {{ sessions.pages }}</span>
    {% if sessions.has_next %}
    <a href="{{ url_for('admin.battles', page=sessions.next_num) }}" class="admin-btn-secondary">Next</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}