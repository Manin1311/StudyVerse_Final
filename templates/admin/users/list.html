{% extends "admin/base.html" %}

{% block title %}Users{% endblock %}
{% block page_title %}User Management{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
    <div>
        <form method="GET" style="display: flex; gap: 12px;">
            <input type="text" name="search" value="{{ search }}" placeholder="Search users..."
                style="padding: 10px 16px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); width: 300px;">
            <select name="filter"
                style="padding: 10px 16px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);">
                <option value="all" {% if filter_type=='all' %}selected{% endif %}>All Users</option>
                <option value="active" {% if filter_type=='active' %}selected{% endif %}>Active (7 days)</option>
                <option value="banned" {% if filter_type=='banned' %}selected{% endif %}>Banned</option>
            </select>
            <button type="submit" class="admin-btn admin-btn-primary">
                <i class="fa-solid fa-search"></i> Search
            </button>
        </form>
    </div>
</div>

<div class="admin-table">
    <table>
        <thead>
            <tr>
                <th>User</th>
                <th>Level</th>
                <th>XP</th>
                <th>Joined</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users.items %}
            <tr>
                <td>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <img src="{{ user.get_avatar(40) }}" style="width: 40px; height: 40px; border-radius: 50%;">
                        <div>
                            <div style="font-weight: 600; color: var(--text-primary);">
                                {{ user.first_name }} {{ user.last_name }}
                                {% if user.is_admin %}<span class="badge"
                                    style="background: #f59e0b; color: white; margin-left: 8px;">ADMIN</span>{% endif %}
                            </div>
                            <div style="font-size: 13px; color: var(--text-secondary);">{{ user.email }}</div>
                        </div>
                    </div>
                </td>
                <td><span class="badge" style="background: var(--primary); color: white;">Level {{ user.level }}</span>
                </td>
                <td>{{ user.total_xp }} XP</td>
                <td>{{ user.created_at.strftime('%b %d, %Y') }}</td>
                <td>
                    {% if user.is_banned %}
                    <span class="badge" style="background: #ef4444; color: white;">Banned</span>
                    {% else %}
                    <span class="badge" style="background: #10b981; color: white;">Active</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{{ url_for('admin_user_detail', user_id=user.id) }}" class="admin-btn admin-btn-secondary"
                        style="font-size: 13px; padding: 6px 12px;">
                        <i class="fa-solid fa-eye"></i> View
                    </a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    No users found
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pagination -->
{% if users.pages > 1 %}
<div style="display: flex; justify-content: center; align-items: center; gap: 8px; margin-top: 24px;">
    {% if users.has_prev %}
    <a href="{{ url_for('admin_users', page=users.prev_num, search=search, filter=filter_type) }}"
        class="admin-btn admin-btn-secondary">
        <i class="fa-solid fa-chevron-left"></i> Previous
    </a>
    {% endif %}

    <span style="color: var(--text-secondary);">Page {{ users.page }} of {{ users.pages }}</span>

    {% if users.has_next %}
    <a href="{{ url_for('admin_users', page=users.next_num, search=search, filter=filter_type) }}"
        class="admin-btn admin-btn-secondary">
        Next <i class="fa-solid fa-chevron-right"></i>
    </a>
    {% endif %}
</div>
{% endif %}
{% endblock %}