{% extends "layout.html" %}

{% block title %}Smart Flashcards - StudyVerse{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">AI Flashcards âš¡</h1>
    <div style="font-size: 1.1rem; color: var(--text-secondary);">
        Master your syllabus with active recall.
    </div>
</div>

<div style="max-width: 600px; margin: 0 auto; display: flex; flex-direction: column; gap: 32px;">

    <!-- Controls -->
    {% if flashcards %}
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div style="color: var(--text-secondary);">
            Card <span id="card-index">1</span> of {{ flashcards|length }}
        </div>
        <button onclick="window.location.reload()" class="btn"
            style="background: rgba(255,255,255,0.05); color: var(--text-secondary);">
            <i class="fa-solid fa-rotate-right"></i> Reshuffle
        </button>
    </div>

    <!-- Flashcard Container -->
    <div class="flashcard-container" style="perspective: 1000px; height: 350px; cursor: pointer;" onclick="flipCard()">
        <div id="flashcard"
            style="position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; border-radius: 20px;">

            <!-- Front -->
            <div class="flashcard-front" style="position: absolute; inset: 0; background: linear-gradient(145deg, #1e293b, #0f172a); 
                border: 1px solid var(--border); border-radius: 20px; backface-visibility: hidden; display: flex; flex-direction: column; 
                justify-content: center; align-items: center; padding: 32px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
                <div
                    style="font-size: 0.9rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 24px;">
                    Question</div>
                <h3 id="card-question" style="font-size: 1.4rem; line-height: 1.5; color: white;">
                    {{ flashcards[0].question }}
                </h3>
                <div style="margin-top: 32px; font-size: 0.8rem; color: var(--text-secondary);">
                    <i class="fa-solid fa-hand-pointer"></i> Tap to flip
                </div>
            </div>

            <!-- Back -->
            <div class="flashcard-back" style="position: absolute; inset: 0; background: linear-gradient(145deg, rgba(var(--accent-green-rgb), 0.1), #0f172a); 
                border: 1px solid var(--accent-green); border-radius: 20px; backface-visibility: hidden; transform: rotateY(180deg); display: flex; flex-direction: column; 
                justify-content: center; align-items: center; padding: 32px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
                <div
                    style="font-size: 0.9rem; color: var(--accent-green); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 24px;">
                    Answer</div>
                <p id="card-answer" style="font-size: 1.1rem; line-height: 1.6; color: rgba(255,255,255,0.9);">
                    {{ flashcards[0].answer }}
                </p>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div style="display: flex; justify-content: center; gap: 24px;">
        <button onclick="prevCard()" class="btn"
            style="width: 60px; height: 60px; border-radius: 50%; border: 1px solid var(--border); font-size: 1.2rem;">
            <i class="fa-solid fa-arrow-left"></i>
        </button>
        <button onclick="nextCard()" class="btn btn-primary"
            style="width: 60px; height: 60px; border-radius: 50%; font-size: 1.2rem; box-shadow: 0 0 20px rgba(var(--accent-green-rgb), 0.3);">
            <i class="fa-solid fa-check"></i>
        </button>
    </div>

    {% else %}
    <div
        style="text-align: center; padding: 60px; background: rgba(255,255,255,0.02); border-radius: 20px; border: 1px dashed var(--border);">
        <i class="fa-solid fa-robot" style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 24px;"></i>
        <h3 style="margin-bottom: 12px; font-size: 1.5rem;">Generating Flashcards...</h3>
        <p style="color: var(--text-secondary); max-width: 400px; margin: 0 auto;">
            Our AI is analyzing your syllabus to create custom study cards. This usually takes about 10-20 seconds.
        </p>
        <div style="margin-top: 32px;">
            <div class="loader"></div>
        </div>
        <script>
            // Simple polling fallback if generating
            setTimeout(() => {
                window.location.reload();
            }, 5000);
        </script>
    </div>
    {% endif %}

</div>

{% endblock %}

{% block scripts %}
<style>
    .flashcard-flipped {
        transform: rotateY(180deg) !important;
    }
</style>
<script>
    const flashcards = {{ flashcards| tojson | safe if flashcards else '[]' }};
    let currentIndex = 0;
    const cardEl = document.getElementById('flashcard');
    const questionEl = document.getElementById('card-question');
    const answerEl = document.getElementById('card-answer');
    const indexEl = document.getElementById('card-index');

    function flipCard() {
        cardEl.classList.toggle('flashcard-flipped');
    }

    function updateCard() {
        // Reset flip
        cardEl.classList.remove('flashcard-flipped');

        // Wait for flip back animation (short delay visual polish)
        setTimeout(() => {
            const card = flashcards[currentIndex];
            questionEl.innerText = card.question;
            answerEl.innerText = card.answer;
            indexEl.innerText = currentIndex + 1;
        }, 200);
    }

    function nextCard() {
        if (currentIndex < flashcards.length - 1) {
            currentIndex++;
            updateCard();
        } else {
            // Loop or finish? Let's loop
            currentIndex = 0;
            updateCard();
        }
    }

    function prevCard() {
        if (currentIndex > 0) {
            currentIndex--;
            updateCard();
        }
    }

    // Keyboard support
    document.addEventListener('keydown', (e) => {
        if (e.code === 'Space') flipCard();
        if (e.code === 'ArrowRight') nextCard();
        if (e.code === 'ArrowLeft') prevCard();
    });
</script>
{% endblock %}